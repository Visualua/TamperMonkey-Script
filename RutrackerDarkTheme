// ==UserScript==
// @name         RuTracker DarkTheme 1.0
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Dark Theme for RuTracker with hidelist
// @author       0x0056
// @match        *://rutracker.org/forum/viewforum.php*
// @match        *://rutracker.net/forum/viewforum.php*
// @match        *://*.rutracker.org/forum/viewforum.php*
// @match        *://*.rutracker.net/forum/viewforum.php*
// @match        *://rutracker.org/forum/viewtopic.php*
// @match        *://rutracker.net/forum/viewtopic.php*
// @match        *://*.rutracker.org/forum/viewtopic.php*
// @match        *://*.rutracker.net/forum/viewtopic.php*
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_addStyle
// ==/UserScript==

(function() {
    'use strict';

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö —Ä–∞–∑–¥–∞—á
    let hiddenTorrents = GM_getValue('hiddenTorrents', {});

    // –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–µ–∫–ª–æ–º–æ—Ä—Ñ–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞
    GM_addStyle(`
        :root {
            --main-bg-color: #0f0f1a;
            --card-bg-color: rgba(27, 28, 49, 0.6);
            --card-bg-hover: rgba(37, 38, 69, 0.7);
            --accent-color: #6c5ce7;
            --accent-secondary: #3498db;
            --accent-gradient: linear-gradient(135deg, #6c5ce7, #3498db);
            --border-color: rgba(255, 255, 255, 0.1);
            --text-color: #ffffff;
            --secondary-text-color: rgba(255, 255, 255, 0.7);
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --glass-blur: blur(10px);
            --glass-border: 1px solid rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --border-radius: 14px;
            --transition-speed: 0.3s;
        }

        /* –§–æ–Ω–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(108, 92, 231, 0.15), transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(52, 152, 219, 0.15), transparent 40%),
                var(--main-bg-color);
            z-index: -1;
        }

        body {
            background-color: transparent !important;
            color: var(--text-color) !important;
            font-family: 'Inter', 'SF Pro Display', sans-serif !important;
            margin: 0;
            padding: 0;
            letter-spacing: 0.2px;
            line-height: 1.5;
            position: relative;
        }

        a {
            color: var(--accent-secondary) !important;
            text-decoration: none !important;
            transition: color var(--transition-speed);
        }

        a:hover {
            color: #74b9ff !important;
        }

        #page_header {
            background-color: transparent !important;
            padding: 15px 0 !important;
            box-shadow: none !important;
        }

        #main-nav {
            background-color: var(--card-bg-color) !important;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius) !important;
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            margin: 0 20px !important;
            padding: 15px 25px !important;
        }

        #logo {
            padding: 20px 0 !important;
        }

        .topmenu {
            background-color: transparent !important;
            border-bottom: none !important;
            padding: 10px 20px !important;
        }

        .forumline {
            border-radius: var(--border-radius) !important;
            overflow: hidden !important;
            border: var(--glass-border) !important;
            margin: 25px 0 !important;
            background-color: var(--card-bg-color) !important;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: var(--glass-shadow);
        }

        .vf-table {
            border-radius: var(--border-radius) !important;
            overflow: hidden !important;
            border: var(--glass-border) !important;
            margin-top: 30px !important;
            background-color: var(--card-bg-color) !important;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            box-shadow: var(--glass-shadow);
        }

        .row1 {
            background-color: rgba(27, 28, 49, 0.4) !important;
            border-bottom: var(--glass-border) !important;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .row2 {
            background-color: rgba(27, 28, 49, 0.2) !important;
            border-bottom: var(--glass-border) !important;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .row3 {
            background: var(--accent-gradient) !important;
            color: white !important;
            padding: 15px 20px !important;
            font-weight: bold !important;
            letter-spacing: 0.5px !important;
            font-size: 15px !important;
            border: none !important;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        table.forumline,
        #page_content,
        #main_content,
        #main_content_wrap,
        #page_container,
        #body_container {
            background-color: transparent !important;
            color: var(--text-color) !important;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ */
        tr.hl-tr {
            transition: background-color var(--transition-speed) !important;
        }

        tr.hl-tr:hover {
            background-color: var(--card-bg-hover) !important;
        }

        tr.hl-tr td {
            border-color: var(--border-color) !important;
            padding: 15px !important;
            vertical-align: middle !important;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑–¥–∞—á–∏ –∏ –∫–Ω–æ–ø–∫–∏ */
        .torTopic {
            display: flex !important;
            align-items: center !important;
            padding: 5px 0 !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ */
        .filter-btn {
            background-color: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.3);
            cursor: pointer;
            margin-right: 10px;
            color: var(--danger-color);
            font-size: 14px;
            font-weight: bold;
            width: 26px;
            height: 26px;
            min-width: 26px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            transition: all 0.3s;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.2);
            order: -1;
        }

        .filter-btn:hover {
            color: white;
            background: var(--danger-color);
            transform: scale(1.1);
            border-color: transparent;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ */
        #filter-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(15, 15, 26, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        #filter-content {
            background-color: var(--card-bg-color);
            padding: 35px;
            border-radius: var(--border-radius);
            width: 650px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: var(--glass-border);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        #filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: var(--glass-border);
            padding-bottom: 15px;
        }

        #filter-header h2 {
            margin: 0;
            color: var(--text-color);
            font-size: 26px;
            font-weight: 700;
        }

        #filter-close {
            background: rgba(255, 255, 255, 0.1);
            border: var(--glass-border);
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        #filter-close:hover {
            background: var(--danger-color);
            transform: rotate(90deg);
        }

        #filter-rules {
            margin-bottom: 30px;
        }

        #filter-rules h3 {
            color: var(--text-color);
            margin-bottom: 15px;
            font-size: 18px;
            position: relative;
            padding-left: 15px;
        }

        #filter-rules h3:before {
            content: "";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 5px;
            height: 20px;
            background: var(--accent-gradient);
            border-radius: 3px;
        }

        .filter-rule {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: rgba(44, 46, 69, 0.5);
            margin-bottom: 12px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border-left: 4px solid var(--accent-color);
        }

        .filter-rule:hover {
            transform: translateX(5px);
            background-color: rgba(44, 46, 69, 0.8);
        }

        .remove-rule {
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);
        }

        .remove-rule:hover {
            background-color: #c0392b;
            transform: scale(1.05);
        }

        #add-filter-form {
            display: flex;
            margin-top: 25px;
        }

        #new-filter {
            flex-grow: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 10px 0 0 10px;
            background-color: rgba(44, 46, 69, 0.8);
            color: var(--text-color);
            font-size: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #add-filter-btn {
            background: var(--accent-gradient);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 14px;
        }

        #add-filter-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .filter-counter {
            background: var(--danger-color);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
            box-shadow: 0 3px 6px rgba(231, 76, 60, 0.3);
            font-weight: bold;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä—ã—Ç—ã—Ö —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ */
        .hidden-torrent {
            display: none !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã–∑–æ–≤–∞ –º–æ–¥–∞–ª–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        #show-filter-modal {
            background: var(--danger-color);
            color: white !important;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-right: 20px;
            display: flex;
            align-items: center;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            transition: all 0.3s;
            letter-spacing: 0.5px;
            font-size: 14px;
        }

        #show-filter-modal:hover {
            background-color: #c0392b;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .preset-filter-btn {
            background-color: rgba(44, 46, 69, 0.8);
            color: var(--text-color);
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-weight: 500;
        }

        .preset-filter-btn:hover {
            background: var(--accent-gradient);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.4);
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã UI */
        h2, h3 {
            color: var(--text-color);
            margin-top: 0;
        }

        .empty-rules {
            color: var(--secondary-text-color);
            font-style: italic;
            padding: 20px;
            text-align: center;
            background-color: rgba(44, 46, 69, 0.5);
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä—É–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü */
        .forumline th {
            background-color: rgba(44, 46, 69, 0.8) !important;
            color: var(--text-color) !important;
            border-bottom: 2px solid var(--accent-color) !important;
            padding: 15px 10px !important;
            font-weight: 600 !important;
            letter-spacing: 0.5px !important;
            text-transform: uppercase !important;
            font-size: 13px !important;
        }

        /* –£–ª—É—á—à–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö */
        .vf-col-replies, .vf-col-last-post {
            color: var(--text-color) !important;
            background-color: rgba(27, 28, 49, 0.4) !important;
        }

        .vf-col-replies p, .vf-col-last-post p {
            color: var(--text-color) !important;
            font-weight: 500 !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        .nav {
            background-color: transparent !important;
            padding: 5px 0 !important;
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ—Å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(27, 28, 49, 0.4);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #8c7ae6;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
        .torTopic {
            font-size: 15px !important;
            font-weight: 500 !important;
            line-height: 1.4 !important;
        }

        .tt-text {
            transition: color 0.2s;
        }

        .tt-text:hover {
            color: var(--accent-color) !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ —Å–∏–¥–æ–≤/–ª–∏—á–µ–π */
        .seedmed {
            color: var(--success-color) !important;
            font-weight: bold !important;
        }

        .leechmed {
            color: var(--warning-color) !important;
            font-weight: bold !important;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –º–µ—Ç–æ–∫ —Ç–µ–º */
        .ttp-label {
            background: var(--accent-gradient);
            color: white !important;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-right: 5px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* –°—Ç–∞—Ç—É—Å—ã —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ */
        .tor-approved {
            color: var(--success-color) !important;
            font-weight: bold !important;
        }

        .tor-not-approved {
            color: var(--danger-color) !important;
            font-weight: bold !important;
        }

        /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –±–ª–æ–∫–∞—Ö */
        .hl-tr td.vf-col-t-title {
            padding: 10px 15px !important;
        }

        .hl-tr td.tCenter {
            text-align: center !important;
            vertical-align: middle !important;
            padding: 10px !important;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–ª–æ–≥–æ —Ñ–æ–Ω–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        tr.hl-tr:hover,
        tr.hl-tr:hover td {
            background-color: rgba(37, 38, 69, 0.7) !important;
            border-color: var(--border-color) !important;
        }

        /* –ü—Ä—è—á–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–∏—è */
        tr:hover > td.row1,
        tr:hover > td.row2,
        tr:hover > td.row4 {
            background-color: rgba(37, 38, 69, 0.7) !important;
        }

        /* –í–∞–∂–Ω—ã–π —Ñ–∏–∫—Å –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .row4,
        tr:hover > .row4,
        .forumline .row4 {
            background-color: rgba(37, 38, 69, 0.7) !important;
        }

        /* –Ø–≤–Ω—ã–π —Ñ–∏–∫—Å –¥–ª—è –±–µ–ª–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Å–ø–∏—Å–∫–µ —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ */
        tr.hl-tr td.row4 {
            background-color: rgba(37, 38, 69, 0.7) !important;
        }
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
#logged-in-username {
    color: var(--accent-secondary) !important;
    font-weight: 500 !important;
}

#logged-in-username:hover {
    color: #74b9ff !important;
    text-decoration: underline !important;
}
/* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–∫–∏ –≤—ã—Ö–æ–¥–∞ */
.log-out-icon {
    filter: brightness(0) saturate(100%) invert(67%) sepia(44%) saturate(3086%) hue-rotate(187deg) brightness(95%) contrast(90%) !important;
    opacity: 0.8 !important;
    transition: all 0.3s ease !important;
    margin-right: 5px !important;
}

.log-out-icon:hover {
    filter: brightness(0) saturate(100%) invert(77%) sepia(78%) saturate(414%) hue-rotate(179deg) brightness(102%) contrast(96%) !important;
    opacity: 1 !important;
    transform: scale(1.1) !important;
    cursor: pointer !important;
}

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        .topicAuthor {
            color: var(--accent-secondary) !important;
            font-weight: 500 !important;
        }

        .topicAuthor:hover {
            color: #74b9ff !important;
            text-decoration: underline !important;
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ—Å–∫–∏ –ø–æ–∏—Å–∫–∞ */
        input[type="text"],
        input[type="search"],
        #search-text,
        #search-menu,
        #search-submit,
        select {
            background-color: rgba(27, 28, 49, 0.6) !important;
            color: var(--text-color) !important;
            border: var(--glass-border) !important;
            box-shadow: none !important;
            border-radius: 8px !important;
            padding: 5px 10px !important;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        #search-submit {
            background: var(--accent-gradient) !important;
            cursor: pointer !important;
            color: white !important;
            border: none !important;
            transition: all 0.3s !important;
        }

        #search-submit:hover {
            box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3) !important;
            transform: translateY(-2px) !important;
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞ –∏ –∫–Ω–æ–ø–æ–∫ –≤ —à–∞–ø–∫–µ */
        #quick-search {
            display: flex !important;
            align-items: center !important;
            background-color: transparent !important;
        }

        /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Ñ–æ—Ä–º –≤–≤–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ */
        input, select, button, .med, .buttonmed {
            color: var(--text-color) !important;
            background-color: rgba(27, 28, 49, 0.6) !important;
            border: var(--glass-border) !important;
            border-radius: 6px !important;
            transition: all 0.3s !important;
        }

        /* –û–±—â–µ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –±–µ–ª—ã–º —Ñ–æ–Ω–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        div, span, p, a, td, th, input, select, textarea, button {
            background-color: transparent !important;
        }
        /* –£–ª—É—á—à–µ–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
#filter-modal {
    background-color: rgba(10, 10, 18, 0.9) !important; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
    backdrop-filter: blur(15px) !important; /* –£—Å–∏–ª–∏–≤–∞–µ–º —Ä–∞–∑–º—ã—Ç–∏–µ —Ñ–æ–Ω–∞ */
    -webkit-backdrop-filter: blur(15px) !important;
}

#filter-content {
    background-color: rgba(20, 21, 35, 0.95) !important; /* –ë–æ–ª–µ–µ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω */
    box-shadow: 0 0 25px rgba(108, 92, 231, 0.5), 0 0 15px rgba(52, 152, 219, 0.3) !important; /* –Ø—Ä–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    padding: 30px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ */
#filter-content h2,
#filter-content h3 {
    text-shadow: 0 0 10px rgba(108, 92, 231, 0.7) !important;
    margin-bottom: 15px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
.preset-filter-btn {
    min-width: 180px !important; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
    white-space: nowrap !important; /* –¢–µ–∫—Å—Ç –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è */
    overflow: hidden !important; /* –°–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ */
    text-overflow: ellipsis !important; /* –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–Ω–æ–≥–æ—Ç–æ—á–∏–µ */
    margin-bottom: 10px !important;
    padding: 12px 15px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ –∫–Ω–æ–ø–∫–∏ */
#new-filter {
    padding: 15px 20px !important;
    font-size: 16px !important;
    height: 48px !important;
}

#add-filter-btn {
    padding: 15px 25px !important;
    font-size: 16px !important;
    height: 48px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ */
.remove-rule {
    padding: 8px 18px !important;
    margin-left: 15px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞ */
input[type="text"],
input[type="search"],
#search-text {
    height: 38px !important;
    min-width: 220px !important;
}

#search-menu {
    height: 38px !important;
}

#search-submit {
    height: 38px !important;
    min-width: 100px !important;
    padding: 0 15px !important;
}

/* –£–ª—É—á—à–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –ø—Ä–∞–≤–∏–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ */
.filter-rule {
    padding: 15px 20px !important;
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    margin-bottom: 12px !important;
}

.filter-rule span {
    font-size: 15px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    max-width: 380px !important;
}
.ttp-label.ttp-hot::before {
        display: none !important;
    }
    /* –°–ø–æ–π–ª–µ—Ä—ã */
    .sp-wrap {
        background: var(--background-card);
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border-color);
        margin-bottom: 15px;
    }

    .sp-head {
        background: rgba(37, 38, 69, 0.5);
        padding: 15px 20px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .sp-head span {
        color: var(--text-primary);
        font-weight: 600;
    }

    .sp-body {
        padding: 20px;
        background: rgba(27, 28, 49, 0.4);
        color: var(--text-primary);
    }

    `);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö —Ä–∞–∑–¥–∞—á
    function loadHiddenTorrents() {
        return GM_getValue('hiddenTorrents', {});
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–∫—Ä—ã—Ç—ã—Ö —Ä–∞–∑–¥–∞—á
    function saveHiddenTorrents() {
        GM_setValue('hiddenTorrents', hiddenTorrents);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    const addFilterButton = () => {
        // –ò—â–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∫–Ω–æ–ø–∫–∏
        const navTop = document.querySelector('.nav-top') ||
              document.querySelector('.nav') ||
              document.querySelector('.forumline');

        if (!navTop) return; // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤—ã—Ö–æ–¥–∏–º

        const hiddenCount = Object.keys(hiddenTorrents).length;
        const filterButton = document.createElement('button');
        filterButton.id = 'show-filter-modal';
        filterButton.innerHTML = `–§–∏–ª—å—Ç—Ä—ã ${hiddenCount > 0 ? `<span class="filter-counter">${hiddenCount}</span>` : ''}`;
        filterButton.addEventListener('click', showFilterModal);

        // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        if (navTop.classList.contains('forumline')) {
            // –ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Ñ–æ—Ä—É–º–∞, –¥–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –Ω–µ–π
            navTop.parentNode.insertBefore(filterButton, navTop);
        } else {
            // –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö, –ø—Ä–æ–±—É–µ–º –≤—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ
            navTop.parentNode.insertBefore(filterButton, navTop);
        }
    };

    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
    const createFilterModal = () => {
        const modal = document.createElement('div');
        modal.id = 'filter-modal';

        const content = document.createElement('div');
        content.id = 'filter-content';

        const header = document.createElement('div');
        header.id = 'filter-header';

        const title = document.createElement('h2');
        title.textContent = '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏';

        const closeBtn = document.createElement('button');
        closeBtn.id = 'filter-close';
        closeBtn.innerHTML = '&times;';
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        header.appendChild(title);
        header.appendChild(closeBtn);

        const rulesSection = document.createElement('div');
        rulesSection.id = 'filter-rules';

        const rulesTitle = document.createElement('h3');
        rulesTitle.textContent = '–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:';
        rulesSection.appendChild(rulesTitle);

        const rulesList = document.createElement('div');
        rulesList.id = 'rules-list';

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        const addPresetSection = document.createElement('div');
        addPresetSection.innerHTML = `
            <h3>–ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                <button id="filter-jpn" class="preset-filter-btn">–°–∫—Ä—ã—Ç—å —Ç–æ—Ä—Ä–µ–Ω—Ç—ã —Å JPN</button>
                <button id="filter-scene" class="preset-filter-btn">–°–∫—Ä—ã—Ç—å [Scene]</button>
                <button id="filter-portable" class="preset-filter-btn">–°–∫—Ä—ã—Ç—å [Portable]</button>
            </div>
        `;

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
        const addFilterForm = document.createElement('div');
        addFilterForm.innerHTML = `
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä:</h3>
            <div id="add-filter-form">
                <input type="text" id="new-filter" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏...">
                <button id="add-filter-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        `;

        // –°–æ–±–∏—Ä–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        content.appendChild(header);
        content.appendChild(rulesSection);
        rulesSection.appendChild(rulesList);
        content.appendChild(addPresetSection);
        content.appendChild(addFilterForm);
        modal.appendChild(content);

        document.body.appendChild(modal);

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.getElementById('filter-jpn').addEventListener('click', () => {
            addFilter('JPN');
            updateRulesList();
            applyFilters();
        });

        document.getElementById('filter-scene').addEventListener('click', () => {
            addFilter('[Scene]');
            updateRulesList();
            applyFilters();
        });

        document.getElementById('filter-portable').addEventListener('click', () => {
            addFilter('[Portable]');
            updateRulesList();
            applyFilters();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
        document.getElementById('add-filter-btn').addEventListener('click', () => {
            const newFilter = document.getElementById('new-filter').value.trim();
            if (newFilter) {
                addFilter(newFilter);
                document.getElementById('new-filter').value = '';
                updateRulesList();
                applyFilters();
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        return modal;
    };

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    const showFilterModal = () => {
        updateRulesList();
        const modal = document.getElementById('filter-modal');
        modal.style.display = 'flex';
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    const updateRulesList = () => {
        const rulesList = document.getElementById('rules-list');
        rulesList.innerHTML = '';

        const hiddenCount = Object.keys(hiddenTorrents).length;

        if (hiddenCount === 0) {
            rulesList.innerHTML = '<div class="empty-rules">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤</div>';
            return;
        }

        for (const [key, value] of Object.entries(hiddenTorrents)) {
            const ruleItem = document.createElement('div');
            ruleItem.className = 'filter-rule';

            const ruleText = document.createElement('span');
            ruleText.textContent = `"${key}" (—Å–∫—Ä—ã—Ç–æ: ${value.count})`;

            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-rule';
            removeBtn.textContent = '–£–¥–∞–ª–∏—Ç—å';
            removeBtn.dataset.rule = key;
            removeBtn.addEventListener('click', () => {
                removeFilter(key);
                updateRulesList();
                applyFilters();
            });

            ruleItem.appendChild(ruleText);
            ruleItem.appendChild(removeBtn);
            rulesList.appendChild(ruleItem);
        }
    };

    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    const addFilter = (filterText) => {
        if (!hiddenTorrents[filterText]) {
            hiddenTorrents[filterText] = { count: 0 };
        }
        saveHiddenTorrents();
    };

    // –£–¥–∞–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    const removeFilter = (filterText) => {
        delete hiddenTorrents[filterText];
        saveHiddenTorrents();

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–Ω–µ–µ —Å–∫—Ä—ã—Ç—ã–µ —Ç–æ—Ä—Ä–µ–Ω—Ç—ã
        document.querySelectorAll('.hidden-torrent').forEach(row => {
            if (row.dataset.hiddenBy === filterText) {
                row.classList.remove('hidden-torrent');
                delete row.dataset.hiddenBy;
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ
        updateFilterCounter();
    };

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∫–æ –≤—Å–µ–º —Ç–æ—Ä—Ä–µ–Ω—Ç–∞–º
    const applyFilters = () => {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏
        for (const key in hiddenTorrents) {
            hiddenTorrents[key].count = 0;
        }

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å —Ç–æ—Ä—Ä–µ–Ω—Ç–∞–º–∏
        const torrentRows = document.querySelectorAll('tr.hl-tr');

        torrentRows.forEach(row => {
            // –°–Ω–∞—á–∞–ª–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏
            row.classList.remove('hidden-torrent');
            delete row.dataset.hiddenBy;

            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞
            const titleElement = row.querySelector('.torTopic a.tt-text');
            if (!titleElement) return;

            const title = titleElement.textContent;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
            for (const [filterText, filterData] of Object.entries(hiddenTorrents)) {
                if (title.includes(filterText)) {
                    row.classList.add('hidden-torrent');
                    row.dataset.hiddenBy = filterText;
                    hiddenTorrents[filterText].count++;
                    break; // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª, —Ç.–∫. —É–∂–µ —Å–∫—Ä—ã–ª–∏ —Ç–æ—Ä—Ä–µ–Ω—Ç
                }
            }
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        saveHiddenTorrents();

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ
        updateFilterCounter();
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ –≤—ã–∑–æ–≤–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    const updateFilterCounter = () => {
        const filterButton = document.getElementById('show-filter-modal');
        if (!filterButton) return;

        const hiddenCount = Object.keys(hiddenTorrents).length;

        if (hiddenCount > 0) {
            filterButton.innerHTML = `–§–∏–ª—å—Ç—Ä—ã <span class="filter-counter">${hiddenCount}</span>`;
        } else {
            filterButton.textContent = '–§–∏–ª—å—Ç—Ä—ã';
        }
    };

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É —Ç–æ—Ä—Ä–µ–Ω—Ç—É
    const addFilterButtons = () => {
        const torrentRows = document.querySelectorAll('tr.hl-tr');

        torrentRows.forEach(row => {
            const titleElement = row.querySelector('.torTopic a.tt-text');
            if (!titleElement) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–∏ —É–∂–µ –∫–Ω–æ–ø–∫–∞
            if (row.querySelector('.filter-btn')) return;

            const filterBtn = document.createElement('button');
            filterBtn.className = 'filter-btn';
            filterBtn.innerHTML = '‚àí'; // –ö—Ä–∞—Å–Ω—ã–π –º–∏–Ω—É—Å
            filterBtn.title = '–°–∫—Ä—ã—Ç—å –ø–æ—Ö–æ–∂–∏–µ —Ä–∞–∑–¥–∞—á–∏';

            filterBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const title = titleElement.textContent;

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–º—è —Ä–∞–∑–¥–∞—á–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
                // –ò—â–µ–º —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É [DL] –∏ [P] –∏–ª–∏ [L]
                const regex = /\[DL\]\s+([^[]+)/;
                const match = title.match(regex);

                if (match && match[1]) {
                    const filterName = match[1].trim();
                    addFilter(filterName);
                    applyFilters();
                    updateRulesList();
                    alert(`–î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä: "${filterName}"`);
                } else {
                    // –ï—Å–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é
                    const userInput = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', '');
                    if (userInput) {
                        addFilter(userInput.trim());
                        applyFilters();
                        updateRulesList();
                    }
                }
            });

            const torTopicDiv = titleElement.parentNode;
            torTopicDiv.insertBefore(filterBtn, torTopicDiv.firstChild);
        });
    };

    function replaceIconWithStar() {
        const icons = document.querySelectorAll('.topic_icon[src$="folder_dl_new.gif"], .topic_icon[src$="folder_dl.gif"]');
        icons.forEach(icon => {
            const starSpan = document.createElement('span');
            starSpan.textContent = '‚≠ê';
            starSpan.style.fontSize = '18px';
            starSpan.style.marginRight = '5px';

            // –ü–æ–∫—Ä–∞—Å–∫–∞ –≤ —Å–µ—Ä—ã–π —Ü–≤–µ—Ç –¥–ª—è —Å—Ç–∞—Ä–æ–π –∏–∫–æ–Ω–∫–∏
            if (icon.src.includes('folder_dl.gif')) {
                starSpan.style.filter = 'grayscale(100%)';
                starSpan.style.color = 'gray';
            }

            icon.parentNode.insertBefore(starSpan, icon);
            icon.remove();
        });

        // –ó–∞–º–µ–Ω–∞ –∏–∫–æ–Ω–∫–∏ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–π —Ç–µ–º—ã –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
        const stickyIcons = document.querySelectorAll('.topic_icon[src$="folder_sticky_new.gif"]');
        stickyIcons.forEach(icon => {
            const warningSpan = document.createElement('span');
            warningSpan.textContent = '‚ö†Ô∏è';
            warningSpan.style.fontSize = '18px';
            warningSpan.style.marginRight = '5px';

            icon.parentNode.insertBefore(warningSpan, icon);
            icon.remove();
        });

        // –ó–∞–º–µ–Ω–∞ –∏–∫–æ–Ω–∫–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —Ç–µ–º—ã –Ω–∞ –∑–∞–º–æ–∫
        const lockedIcons = document.querySelectorAll('.topic_icon[src$="folder_lock.gif"]');
        lockedIcons.forEach(icon => {
            const lockSpan = document.createElement('span');
            lockSpan.textContent = 'üîí';
            lockSpan.style.fontSize = '18px';
            lockSpan.style.marginRight = '5px';

            icon.parentNode.insertBefore(lockSpan, icon);
            icon.remove();
        });

        // –ó–∞–º–µ–Ω–∞ –∏–∫–æ–Ω–∫–∏ –∑–∞–∫—Ä—ã—Ç–æ–π —Ç–µ–º—ã –Ω–∞ –∑–∞–º–æ–∫
        const lockedIcons2 = document.querySelectorAll('.topic_icon[src$="folder_announce.gif"]');
        lockedIcons2.forEach(icon => {
            const lockSpan2 = document.createElement('span');
            lockSpan2.textContent = '‚ö†Ô∏è';
            lockSpan2.style.fontSize = '18px';
            lockSpan2.style.marginRight = '5px';

            icon.parentNode.insertBefore(lockSpan2, icon);
            icon.remove();
        });
    }

    function hideButton() {
        const xpaths = [
            '//*[@id="main_content_wrap"]/table[1]/tbody/tr/td[1]/table/tbody/tr/td[1]',
            '//*[@id="main_content_wrap"]/table[4]/tbody/tr/td[1]/a',
            '//*[@id="nav-panel"]',
            '//*[@id="main_content_wrap"]/table[3]/tbody/tr[58]/td/form',
            '//*[@id="jumpbox-wrap"]/select',
            '//*[@id="footer-info-links"]',
            '//*[@id="main_content_wrap"]/table[4]/tbody/tr/td[2]',
            '//*[@id="page_footer"]/div[4]',
            '//*[@id="main_content_wrap"]/div/div[3]/ul/li/a',
            '//*[@id="main_content_wrap"]/table[1]/tbody/tr/td[1]/div[3]',
            '//*[@id="main_content_wrap"]/table[1]/tbody/tr/td[1]/div[1]',
            '//*[@id="main_content_wrap"]/table[2]'
        ];

        const selectors = [

            'a.t-is-unread > img' // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–æ–±–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        ];

        xpaths.forEach(xpath => {
            const element = document.evaluate(xpath, document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;

            if (element) {
                element.style.display = 'none';
            }
        });

        selectors.forEach(selector => {
            const elements = document.querySelectorAll(selector);

            elements.forEach(element => {
                element.style.display = 'none';
            });
        });
    }

    function replaceHotLabel() {
        // –ó–∞–º–µ–Ω–∞ "–≥–æ—Ä—è—á–µ–π" –º–µ—Ç–∫–∏
        const hotLabels = document.querySelectorAll('span.ttp-label.ttp-hot');

        hotLabels.forEach(label => {
            label.textContent = 'üî•';
            label.style.fontSize = '18px';
            label.style.position = 'static';
        });

        // –ó–∞–º–µ–Ω–∞ "–û–ø—Ä–æ—Å"
        const pollLabels = document.querySelectorAll('span.topicPoll');

        pollLabels.forEach(label => {
            label.textContent = 'üìë';
            label.style.fontSize = '18px';
        });
    }

    function hideElements() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º t=
        if (window.location.href.includes('viewtopic.php?t=')) {
            const xpaths = [
                '//*[@id="main_content_wrap"]/div[1]',
                '//*[@id="topic_main"]/tbody[1]',
                '//*[@id="post-msg-form"]',
                '//*[@id="show-filter-modal"]',
                '//*[@id="forum-moderators"]',
                '//*[@id="main_content_wrap"]/table[5]',
                '//*[@id="p-50708427-1"]/table[1]/tbody/tr[3]',
                '//*[@id="p-50708427-1"]/table[1]/tbody/tr[4]',
                '//*[@id="p-50708427-1"]/table[1]/tbody/tr[5]',
                '//*[@id="p-50708427-1"]/table[1]/tbody/tr[2]/td[1]',
                '//*[@id="p-50708427-1"]/table[1]/tbody/tr[2]/td[2]',
                '//*[@id="p-50708427-1"]/table[1]/tbody/tr[1]',
                '//*[@id="thx-btn-div"]',
                '//*[@id="thx-block"]/div[2]'
            ];

            xpaths.forEach(xpath => {
                try {
                    const element = document.evaluate(
                        xpath,
                        document,
                        null,
                        XPathResult.FIRST_ORDERED_NODE_TYPE,
                        null
                    ).singleNodeValue;

                    if (element) {
                        element.style.display = 'none';
                    }
                } catch (error) {
                    console.error(`Error finding element with xpath: ${xpath}`, error);
                }
            });
        }
    }



    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–∞
    const init = () => {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
        hiddenTorrents = loadHiddenTorrents();

        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        createFilterModal();

        // –ó–∞–º–µ–Ω–∞ –∏–∫–æ–Ω–æ–∫
        replaceIconWithStar();

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
        addFilterButton();


        hideElements();

        //–ó–∞–º–µ–Ω–∞ –º–µ—Ç–æ–∫
        replaceHotLabel();

        // –°–∫—Ä—ã—Ç–∏–µ –Ω–µ–Ω—É–∂–Ω–æ–≥–æ
        hideButton();

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫ —Ç–æ—Ä—Ä–µ–Ω—Ç–∞–º
        addFilterButtons();

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
        applyFilters();

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
        updateRulesList();
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    document.addEventListener('DOMContentLoaded', init);

    // –ï—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É
    if (document.readyState === 'interactive' || document.readyState === 'complete') {
        init();
    }
})();
